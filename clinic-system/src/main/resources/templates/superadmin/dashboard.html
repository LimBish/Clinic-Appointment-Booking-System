<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<!--<head th:replace="~{fragments/layout :: head('Super Admin — Platform Dashboard')}"></head>-->

<head>dashboard</head>
<body class="bg-light d-flex flex-column" style="min-height:100vh">

<div th:replace="~{fragments/layout :: navbar}"></div>
<div th:replace="~{fragments/layout :: alerts}"></div>

<main class="container-xl my-4 flex-grow-1">

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h4 class="fw-bold mb-0">
                <i class="bi bi-globe2 me-2 text-primary"></i>Platform Dashboard
            </h4>
            <small class="text-muted">Cross-clinic overview — Super Admin view</small>
        </div>
        <a th:href="@{/superadmin/clinics/new}" class="btn btn-primary">
            <i class="bi bi-plus-circle me-1"></i>Register New Clinic
        </a>
    </div>

    <!-- ── Platform Stats Cards ── -->
    <div class="row g-3 mb-4">

        <!-- Total Clinics -->
        <div class="col-6 col-xl-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <p class="text-muted small mb-1">Total Clinics</p>
                            <h2 class="fw-bold mb-0" th:text="${stats.totalClinics}">0</h2>
                        </div>
                        <i class="bi bi-building fs-1 text-primary opacity-25"></i>
                    </div>
                    <div class="mt-2 small">
                        <span class="text-success me-2">
                            <i class="bi bi-circle-fill" style="font-size:8px"></i>
                            <span th:text="${stats.activeClinics}">0</span> active
                        </span>
                        <span class="text-warning me-2">
                            <i class="bi bi-circle-fill" style="font-size:8px"></i>
                            <span th:text="${stats.pendingClinics}">0</span> pending
                        </span>
                        <span class="text-danger">
                            <i class="bi bi-circle-fill" style="font-size:8px"></i>
                            <span th:text="${stats.suspendedClinics}">0</span> suspended
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Total Doctors -->
        <div class="col-6 col-xl-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <p class="text-muted small mb-1">Total Doctors</p>
                            <h2 class="fw-bold mb-0" th:text="${stats.totalDoctors}">0</h2>
                        </div>
                        <i class="bi bi-person-badge fs-1 text-success opacity-25"></i>
                    </div>
                    <small class="text-muted">Across all active clinics</small>
                </div>
            </div>
        </div>

        <!-- Total Patients -->
        <div class="col-6 col-xl-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <p class="text-muted small mb-1">Total Patients</p>
                            <h2 class="fw-bold mb-0" th:text="${stats.totalPatients}">0</h2>
                        </div>
                        <i class="bi bi-people fs-1 text-info opacity-25"></i>
                    </div>
                    <small class="text-muted">Registered platform-wide</small>
                </div>
            </div>
        </div>

        <!-- Notification Delivery -->
        <div class="col-6 col-xl-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <p class="text-muted small mb-1">Notification Rate (30d)</p>
                            <h2 class="fw-bold mb-0">
                                <span th:text="${#numbers.formatDecimal(stats.notificationDeliveryRatePercent,1,1)}">0</span>%
                            </h2>
                        </div>
                        <i class="bi bi-envelope-check fs-1 text-warning opacity-25"></i>
                    </div>
                    <small th:classappend="${stats.notificationDeliveryRatePercent >= 95} ? 'text-success' : 'text-danger'">
                        Target: ≥ 95%
                    </small>
                </div>
            </div>
        </div>

    </div>

    <!-- ── All Clinics Table ── -->
    <div class="card shadow-sm">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h6 class="mb-0"><i class="bi bi-building me-2"></i>All Clinics</h6>
            <div>
                <a th:href="@{/superadmin/clinics(status='PENDING')}"
                   class="btn btn-outline-warning btn-sm me-1">Pending</a>
                <a th:href="@{/superadmin/clinics(status='SUSPENDED')}"
                   class="btn btn-outline-danger btn-sm me-1">Suspended</a>
                <a th:href="@{/superadmin/clinics}"
                   class="btn btn-outline-secondary btn-sm">All</a>
            </div>
        </div>
        <div class="card-body p-0">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Code</th>
                        <th>Clinic Name</th>
                        <th>City</th>
                        <th>Plan</th>
                        <th>Doctors</th>
                        <th>Patients</th>
                        <th>Status</th>
                        <th>Registered</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="clinic : ${recentClinics}">
                        <td>
                            <code class="small" th:text="${clinic.registrationCode}"></code>
                        </td>
                        <td class="fw-semibold" th:text="${clinic.name}"></td>
                        <td th:text="${clinic.city}"></td>
                        <td>
                            <span class="badge bg-light text-dark border"
                                  th:text="${clinic.subscriptionPlan}"></span>
                        </td>
                        <td>
                            <span th:text="${clinic.totalDoctors}"></span>
                            <span class="text-muted small">/ <span th:text="${clinic.maxDoctors}"></span></span>
                        </td>
                        <td th:text="${clinic.totalPatients}"></td>
                        <td>
                            <span class="badge"
                                  th:classappend="${clinic.status == 'ACTIVE'}     ? 'bg-success'
                                              : (${clinic.status == 'PENDING'}    ? 'bg-warning text-dark'
                                              : (${clinic.status == 'SUSPENDED'}  ? 'bg-danger'
                                              : 'bg-secondary'))"
                                  th:text="${clinic.status}"></span>
                        </td>
                        <td class="small text-muted"
                            th:text="${#temporals.format(clinic.createdAt, 'dd MMM yyyy')}"></td>
                        <td>
                            <a th:href="@{/superadmin/clinics/{id}(id=${clinic.id})}"
                               class="btn btn-outline-primary btn-sm">Manage</a>
                        </td>
                    </tr>

                    <tr th:if="${#lists.isEmpty(recentClinics)}">
                        <td colspan="9" class="text-center text-muted py-4">
                            No clinics registered yet.
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

</main>

<div th:replace="~{fragments/layout :: footer}"></div>
<div th:replace="~{fragments/layout :: scripts}"></div>
</body>
</html>
